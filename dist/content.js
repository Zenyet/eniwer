var se=Object.defineProperty;var ie=(d,u,f)=>u in d?se(d,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):d[u]=f;var c=(d,u,f)=>ie(d,typeof u!="symbol"?u+"":u,f);(function(){"use strict";const d={translate:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></svg>',summarize:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>',explain:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>',rewrite:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>',search:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',copy:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>',sendToAI:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2 11 13"/><path d="M22 2 15 22 11 13 2 9l20-7z"/></svg>',codeExplain:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>',aiChat:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',summarizePage:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>',switchTab:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>',history:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>',screenshot:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>',bookmark:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>',newTab:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',circle:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2" fill="currentColor"/></svg>',download:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>',sparkles:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>',messageCircle:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>',fileText:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>',x:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>'};let u=null,f=null,I=!1;function T(){return f||R(),f}function R(){u=document.createElement("div"),u.id="thecircle-shadow-host",u.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    z-index: 2147483647;
    pointer-events: none;
  `,document.body.appendChild(u),f=u.attachShadow({mode:"open"});const l=document.createElement("div");l.id="thecircle-container",l.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
  `,f.appendChild(l)}function B(l){if(I||!f)return;const e=document.createElement("style");e.textContent=l,f.insertBefore(e,f.firstChild),I=!0}function w(l){const e=T(),t=e.getElementById("thecircle-container")||e;l.style.pointerEvents="auto",t.appendChild(l)}function x(l){l.parentNode&&l.parentNode.removeChild(l)}const b=new Map;function L(){return`${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function m(){for(const[l,e]of b){try{e.port.disconnect()}catch{}b.delete(l)}}async function $(l,e,t,s){return t.useStreaming&&!!s?D("AI_REQUEST",{action:"custom",text:l,systemPrompt:e,config:t},s):await chrome.runtime.sendMessage({type:"AI_REQUEST",payload:{action:"custom",text:l,systemPrompt:e,config:t}})}async function k(l,e,t,s){return t.useStreaming&&!!s?U(l,e,t,s):await chrome.runtime.sendMessage({type:"AI_VISION_REQUEST",payload:{imageDataUrl:l,prompt:e,config:t}})}async function H(l,e,t){return await chrome.runtime.sendMessage({type:"AI_IMAGE_GEN_REQUEST",payload:{prompt:l,config:e,screenshotConfig:t}})}async function D(l,e,t){return new Promise(s=>{const i=L(),n=chrome.runtime.connect({name:"ai-stream"});b.set(i,{port:n,requestId:i});const o=()=>{b.delete(i);try{n.onMessage.removeListener(r)}catch{}},r=a=>{var h;((h=a.payload)==null?void 0:h.requestId)===i&&(a.type==="AI_STREAM_CHUNK"?t(a.payload.chunk||"",a.payload.fullText||""):a.type==="AI_STREAM_END"?(o(),n.disconnect(),s({success:a.payload.success||!1,result:a.payload.result,error:a.payload.error,requestId:i})):a.type==="AI_STREAM_ERROR"&&(o(),n.disconnect(),s({success:!1,error:a.payload.error||"Unknown error",requestId:i})))};n.onDisconnect.addListener(()=>{o(),s({success:!1,error:"请求已取消",requestId:i})}),n.onMessage.addListener(r),n.postMessage({type:l,payload:{...e,requestId:i}})})}async function U(l,e,t,s){return new Promise(i=>{const n=L(),o=chrome.runtime.connect({name:"ai-stream"});b.set(n,{port:o,requestId:n});const r=()=>{b.delete(n);try{o.onMessage.removeListener(a)}catch{}},a=h=>{var p;((p=h.payload)==null?void 0:p.requestId)===n&&(h.type==="AI_STREAM_CHUNK"?s(h.payload.chunk||"",h.payload.fullText||""):h.type==="AI_STREAM_END"?(r(),o.disconnect(),i({success:h.payload.success||!1,result:h.payload.result,error:h.payload.error,requestId:n})):h.type==="AI_STREAM_ERROR"&&(r(),o.disconnect(),i({success:!1,error:h.payload.error||"Unknown error",requestId:n})))};o.onDisconnect.addListener(()=>{r(),i({success:!1,error:"请求已取消",requestId:n})}),o.onMessage.addListener(a),o.postMessage({type:"AI_VISION_REQUEST",payload:{imageDataUrl:l,prompt:e,config:t,requestId:n}})})}function q(l){return`You are a professional translator. Translate the following text to ${l}. Only output the translation, nothing else.`}function j(){return"You are a summarization expert. Summarize the following text in a concise manner, keeping the key points. Use bullet points if appropriate. Output in the same language as the input."}function _(){return"You are a helpful teacher. Explain the following text in simple terms that anyone can understand. Output in the same language as the input."}function F(){return"You are a professional editor. Rewrite the following text to make it clearer, more engaging, and well-structured. Keep the same meaning. Output in the same language as the input."}function O(){return"You are a senior software engineer. Explain the following code in detail, including what it does, how it works, and any important concepts. Output in the same language as the input text (if any) or in English."}function Y(){return"You are a summarization expert. Summarize the following webpage content in a comprehensive but concise manner. Include the main topic, key points, and any important details. Use bullet points for clarity. Output in the same language as the content."}function K(){return`请详细描述这张图片的内容，包括：
1. 主要元素和对象
2. 场景和环境
3. 颜色和视觉特征
4. 任何文字或标识
5. 整体氛围和主题

请用中文回答。`}function N(l){return`请根据这张图片回答以下问题：

${l}

请用中文回答，尽量详细和准确。`}class X{constructor(){c(this,"container",null);c(this,"overlay",null);c(this,"menuItems",[]);c(this,"selectedIndex",-1);c(this,"centerX",0);c(this,"centerY",0);c(this,"isVisible",!1);c(this,"onSelect",null);c(this,"resultPanel",null);c(this,"selectionRect",null);c(this,"radius",120);c(this,"isLoading",!1);c(this,"onStopCallback",null);this.handleMouseMove=this.handleMouseMove.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleClick=this.handleClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}setSelectionInfo(e){this.selectionRect=e}show(e,t,s,i){this.isVisible&&this.hide(),this.menuItems=s.filter(r=>r.enabled!==!1).sort((r,a)=>(r.order??0)-(a.order??0)),this.onSelect=i,this.centerX=e,this.centerY=t,this.selectedIndex=-1,this.isVisible=!0;const n=Math.min(120,(Math.min(window.innerWidth,window.innerHeight)-100)/2),o=this.menuItems.length;o<=4?this.radius=n*.75:o<=6?this.radius=n*.85:this.radius=n,this.createOverlay(),this.createMenu(),this.attachEventListeners()}hide(){this.isVisible=!1,this.detachEventListeners(),this.overlay&&(this.overlay.classList.add("thecircle-fade-out"),setTimeout(()=>{this.overlay&&(x(this.overlay),this.overlay=null,this.container=null)},200))}showResultOnly(e,t,s){this.centerX=e,this.centerY=t,this.showResult(s,"",!0)}hideResultPanel(){this.isLoading&&(m(),this.isLoading=!1),this.resultPanel&&(this.resultPanel.classList.add("thecircle-fade-out"),setTimeout(()=>{this.resultPanel&&(x(this.resultPanel),this.resultPanel=null)},200))}setOnStop(e){this.onStopCallback=e}showResult(e,t,s=!1){this.hideResultPanel(),this.isLoading=s,this.resultPanel=document.createElement("div"),this.resultPanel.className="thecircle-result-panel";const i=s?`<div class="thecircle-loading-container">
           <div class="thecircle-loading-row">
             <div class="thecircle-spinner"></div>
             <span class="thecircle-loading-text">正在思考...</span>
           </div>
           <button class="thecircle-stop-btn" data-action="stop">
             <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
               <rect x="6" y="6" width="12" height="12" rx="2"></rect>
             </svg>
             终止
           </button>
         </div>`:t;this.resultPanel.innerHTML=`
      <div class="thecircle-result-header">
        <span class="thecircle-result-title">${e}</span>
        <button class="thecircle-result-close">×</button>
      </div>
      <div class="thecircle-result-content-wrapper">
        <div class="thecircle-result-content">
          ${i}
        </div>
      </div>
      ${s?"":this.createCopyButtonHTML()}
    `,w(this.resultPanel);const n=this.resultPanel.getBoundingClientRect();let o,r;this.selectionRect?(o=this.selectionRect.left+this.selectionRect.width/2-n.width/2,r=this.selectionRect.bottom+15,r+n.height>window.innerHeight-20&&(r=this.selectionRect.top-n.height-15)):(o=(window.innerWidth-n.width)/2,r=(window.innerHeight-n.height)/2),o<20&&(o=20),o+n.width>window.innerWidth-20&&(o=window.innerWidth-n.width-20),r<20&&(r=20),r+n.height>window.innerHeight-20&&(r=window.innerHeight-n.height-20),this.resultPanel.style.left=`${o}px`,this.resultPanel.style.top=`${r}px`;const a=this.resultPanel.querySelector(".thecircle-result-close");if(a==null||a.addEventListener("click",()=>this.hideResultPanel()),s){const h=this.resultPanel.querySelector('[data-action="stop"]');h==null||h.addEventListener("click",()=>{var p;m(),this.isLoading=!1,(p=this.onStopCallback)==null||p.call(this),this.hideResultPanel()})}this.setupCopyButton(t),this.setupScrollIndicators()}createCopyButtonHTML(){return`
      <div class="thecircle-result-actions">
        <button class="thecircle-copy-btn">
          <span class="thecircle-copy-btn-icon">${this.getCopyIcon()}</span>
          <span class="thecircle-copy-btn-text">复制</span>
        </button>
      </div>
    `}getCopyIcon(){return`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
    </svg>`}getCheckIcon(){return`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>`}setupCopyButton(e){if(!this.resultPanel)return;const t=this.resultPanel.querySelector(".thecircle-copy-btn");t&&t.addEventListener("click",()=>{navigator.clipboard.writeText(e),this.showCopyFeedback(t)})}showCopyFeedback(e){const t=e.querySelector(".thecircle-copy-btn-icon"),s=e.querySelector(".thecircle-copy-btn-text");t&&s&&(e.classList.add("copied"),t.innerHTML=this.getCheckIcon(),s.textContent="已复制!",setTimeout(()=>{e.classList.remove("copied"),t.innerHTML=this.getCopyIcon(),s.textContent="复制"},1500))}setupScrollIndicators(){if(!this.resultPanel)return;const e=this.resultPanel.querySelector(".thecircle-result-content-wrapper"),t=this.resultPanel.querySelector(".thecircle-result-content");if(e&&t){const s=()=>{const{scrollTop:i,scrollHeight:n,clientHeight:o}=t,r=i>5,a=i<n-o-5;e.classList.toggle("has-scroll-top",r),e.classList.toggle("has-scroll-bottom",a)};t.addEventListener("scroll",s),requestAnimationFrame(s)}}updateResult(e){if(this.isLoading=!1,this.resultPanel){const t=this.resultPanel.querySelector(".thecircle-result-content");t&&(t.innerHTML=e),this.ensureCopyButton(e),this.setupScrollIndicators()}}streamUpdate(e,t){if(this.isLoading=!0,this.resultPanel){const s=this.resultPanel.querySelector(".thecircle-result-content");if(s){if(s.querySelector(".thecircle-loading-container")){s.innerHTML=`
            <div style="display: flex; justify-content: flex-end; margin-bottom: 8px;">
              <button class="thecircle-stop-btn" data-action="stop">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                </svg>
                终止
              </button>
            </div>
            <div class="thecircle-stream-content"></div>
          `;const n=s.querySelector('[data-action="stop"]');n==null||n.addEventListener("click",()=>{var o;m(),this.isLoading=!1,(o=n.parentElement)==null||o.remove()})}const i=s.querySelector(".thecircle-stream-content");i?i.innerHTML=this.formatStreamContent(t):s.innerHTML=this.formatStreamContent(t),s.scrollTop=s.scrollHeight}this.ensureCopyButton(t)}}formatStreamContent(e){return e.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>")}ensureCopyButton(e){if(!this.resultPanel)return;const t=this.resultPanel.querySelector(".thecircle-result-actions");if(t){const s=t.querySelector(".thecircle-copy-btn");if(s){const i=s.cloneNode(!0);i.addEventListener("click",()=>{navigator.clipboard.writeText(e),this.showCopyFeedback(i)}),s.replaceWith(i)}}else{const s=document.createElement("div");s.className="thecircle-result-actions",s.innerHTML=`
        <button class="thecircle-copy-btn">
          <span class="thecircle-copy-btn-icon">${this.getCopyIcon()}</span>
          <span class="thecircle-copy-btn-text">复制</span>
        </button>
      `,this.resultPanel.appendChild(s);const i=s.querySelector(".thecircle-copy-btn");i==null||i.addEventListener("click",()=>{navigator.clipboard.writeText(e),this.showCopyFeedback(i)})}}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="thecircle-overlay",w(this.overlay)}createMenu(){this.container=document.createElement("div"),this.container.className="thecircle-menu",this.container.style.left=`${this.centerX}px`,this.container.style.top=`${this.centerY}px`;const e=document.createElement("div");e.className="thecircle-center",e.innerHTML=`
      <span class="thecircle-center-icon">${d.circle}</span>
      <span class="thecircle-center-label">选择操作</span>
    `,this.container.appendChild(e);const t=this.menuItems.length;this.menuItems.forEach((s,i)=>{const n=i/t*2*Math.PI-Math.PI/2,o=Math.cos(n)*this.radius,r=Math.sin(n)*this.radius,a=document.createElement("div");a.className="thecircle-item",a.dataset.index=String(i),a.style.setProperty("--x",`${o}px`),a.style.setProperty("--y",`${r}px`),a.style.transform=`translate(${o}px, ${r}px)`;const h=s.customIcon||s.icon,p=s.customLabel||s.label;a.innerHTML=`
        <span class="thecircle-item-icon">${h}</span>
        <span class="thecircle-item-label">${p}</span>
      `,this.container.appendChild(a)}),this.overlay.appendChild(this.container),requestAnimationFrame(()=>{var s;(s=this.container)==null||s.classList.add("thecircle-menu-visible")})}attachEventListeners(){document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("click",this.handleClick),document.addEventListener("keydown",this.handleKeyDown)}detachEventListeners(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("click",this.handleClick),document.removeEventListener("keydown",this.handleKeyDown)}handleMouseMove(e){if(!this.isVisible||!this.container)return;const t=e.clientX-this.centerX,s=e.clientY-this.centerY;if(Math.sqrt(t*t+s*s)<40){this.setSelectedIndex(-1);return}let n=Math.atan2(s,t);n=n+Math.PI/2,n<0&&(n+=2*Math.PI);const o=this.menuItems.length,r=2*Math.PI/o,a=Math.floor((n+r/2)%(2*Math.PI)/r);this.setSelectedIndex(a)}setSelectedIndex(e){var s,i,n,o,r,a,h;if(this.selectedIndex===e)return;if(this.selectedIndex>=0){const p=(s=this.container)==null?void 0:s.querySelector(`[data-index="${this.selectedIndex}"]`);p==null||p.classList.remove("thecircle-item-selected")}this.selectedIndex=e;const t=(i=this.container)==null?void 0:i.querySelector(".thecircle-center");if(e>=0&&e<this.menuItems.length){const p=(n=this.container)==null?void 0:n.querySelector(`[data-index="${e}"]`);p==null||p.classList.add("thecircle-item-selected"),t==null||t.classList.add("thecircle-center-visible");const g=(o=this.container)==null?void 0:o.querySelector(".thecircle-center-label"),z=(r=this.container)==null?void 0:r.querySelector(".thecircle-center-icon");if(g&&z){const v=this.menuItems[e];g.textContent=v.customLabel||v.label,z.innerHTML=v.customIcon||v.icon}}else{t==null||t.classList.remove("thecircle-center-visible");const p=(a=this.container)==null?void 0:a.querySelector(".thecircle-center-label"),g=(h=this.container)==null?void 0:h.querySelector(".thecircle-center-icon");p&&g&&(p.textContent="选择操作",g.innerHTML=d.circle)}}handleKeyUp(e){e.key==="Alt"&&this.selectedIndex>=0&&this.executeSelection()}handleKeyDown(e){if(!this.isVisible)return;const t=this.menuItems.length;switch(e.key){case"Escape":e.preventDefault(),this.hide();break;case"ArrowRight":e.preventDefault(),this.setSelectedIndex(this.selectedIndex<0?0:(this.selectedIndex+1)%t);break;case"ArrowLeft":e.preventDefault(),this.setSelectedIndex(this.selectedIndex<0?t-1:(this.selectedIndex-1+t)%t);break;case"ArrowUp":if(e.preventDefault(),this.selectedIndex<0)this.setSelectedIndex(0);else{const i=(this.selectedIndex+Math.floor(t/2))%t;this.setSelectedIndex(i)}break;case"ArrowDown":if(e.preventDefault(),this.selectedIndex<0)this.setSelectedIndex(Math.floor(t/2));else{const i=(this.selectedIndex+Math.floor(t/2))%t;this.setSelectedIndex(i)}break;case"Tab":e.preventDefault(),e.shiftKey?this.setSelectedIndex(this.selectedIndex<0?t-1:(this.selectedIndex-1+t)%t):this.setSelectedIndex(this.selectedIndex<0?0:(this.selectedIndex+1)%t);break;case"Enter":e.preventDefault(),this.selectedIndex>=0&&this.executeSelection();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":e.preventDefault();const s=parseInt(e.key)-1;s<t&&(this.setSelectedIndex(s),this.executeSelection());break}}handleClick(e){var n,o;if(!this.isVisible)return;const t=e.composedPath();let s=null,i=!1;for(const r of t)r instanceof HTMLElement&&((n=r.classList)!=null&&n.contains("thecircle-item")&&(s=r),(o=r.classList)!=null&&o.contains("thecircle-menu")&&(i=!0));if(s){const r=parseInt(s.getAttribute("data-index")||"-1");r>=0&&(this.selectedIndex=r,this.executeSelection())}else i||this.hide()}executeSelection(){var e;if(this.selectedIndex>=0&&this.selectedIndex<this.menuItems.length){const t=this.menuItems[this.selectedIndex];this.hide(),(e=this.onSelect)==null||e.call(this,t)}}}const y={saveToFile:!0,copyToClipboard:!1,enableAI:!0,defaultAIAction:"none",imageQuality:.92,enableImageGen:!1,imageGenProvider:"openai",imageSize:"1024x1024"},S={shortcut:"Double+Shift",theme:"dark",preferredLanguage:"zh-CN",apiProvider:"groq",useStreaming:!0,screenshot:y,popoverPosition:"above"},C=[{id:"translate",icon:d.translate,label:"翻译",action:"translate",enabled:!0,order:0},{id:"summarize",icon:d.summarize,label:"总结",action:"summarize",enabled:!0,order:1},{id:"explain",icon:d.explain,label:"解释",action:"explain",enabled:!0,order:2},{id:"rewrite",icon:d.rewrite,label:"改写",action:"rewrite",enabled:!0,order:3},{id:"search",icon:d.search,label:"搜索",action:"search",enabled:!0,order:4},{id:"copy",icon:d.copy,label:"复制",action:"copy",enabled:!0,order:5},{id:"sendToAI",icon:d.sendToAI,label:"发送到 AI",action:"sendToAI",enabled:!0,order:6},{id:"codeExplain",icon:d.codeExplain,label:"代码解释",action:"codeExplain",enabled:!0,order:7}],E=[{id:"aiChat",icon:d.aiChat,label:"AI 对话",action:"aiChat",enabled:!0,order:0},{id:"summarizePage",icon:d.summarizePage,label:"总结页面",action:"summarizePage",enabled:!0,order:1},{id:"switchTab",icon:d.switchTab,label:"标签切换",action:"switchTab",enabled:!0,order:2},{id:"history",icon:d.history,label:"历史记录",action:"history",enabled:!0,order:3},{id:"screenshot",icon:d.screenshot,label:"截图",action:"screenshot",enabled:!0,order:4},{id:"bookmark",icon:d.bookmark,label:"书签",action:"bookmark",enabled:!0,order:5},{id:"newTab",icon:d.newTab,label:"新标签",action:"newTab",enabled:!0,order:6},{id:"settings",icon:d.settings,label:"设置",action:"settings",enabled:!0,order:7}],V=`
.thecircle-screenshot-overlay {
  position: fixed;
  inset: 0;
  z-index: 2147483646;
  background: transparent;
  cursor: crosshair;
  animation: thecircle-ss-fade-in 0.15s ease-out;
}
.thecircle-screenshot-overlay.thecircle-screenshot-selecting {
  background: transparent;
}
.thecircle-screenshot-overlay.thecircle-screenshot-idle {
  background: rgba(0, 0, 0, 0.3);
}
.thecircle-screenshot-overlay.thecircle-screenshot-has-selection {
  cursor: default;
}
.thecircle-screenshot-fade-out {
  animation: thecircle-ss-fade-out 0.2s ease-out forwards;
}
@keyframes thecircle-ss-fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes thecircle-ss-fade-out {
  from { opacity: 1; }
  to { opacity: 0; }
}
.thecircle-screenshot-hint {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: rgba(30, 30, 30, 0.9);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 9999px;
  color: rgba(255, 255, 255, 0.95);
  font-size: 14px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  transition: opacity 0.2s ease;
}
.thecircle-screenshot-hint-divider {
  color: rgba(255, 255, 255, 0.3);
}
.thecircle-screenshot-hint-key {
  background: rgba(255, 255, 255, 0.15);
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}
.thecircle-screenshot-selection {
  position: fixed;
  border: 2px solid #3b82f6;
  background: transparent;
  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
  pointer-events: none;
  cursor: move;
}
.thecircle-screenshot-selection.thecircle-screenshot-selection-active {
  pointer-events: auto;
  cursor: move;
}
.thecircle-screenshot-selection.thecircle-screenshot-selection-breathe {
  animation: thecircle-ss-breathe 0.4s ease-out;
}
@keyframes thecircle-ss-breathe {
  0% { border-color: #3b82f6; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5); }
  50% { border-color: #60a5fa; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.4), 0 0 20px rgba(59, 130, 246, 0.5); }
  100% { border-color: #3b82f6; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5); }
}
.thecircle-screenshot-size {
  position: fixed;
  transform: translateX(-50%);
  padding: 4px 10px;
  background: rgba(30, 30, 30, 0.9);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 4px;
  color: rgba(255, 255, 255, 0.95);
  font-size: 12px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  pointer-events: none;
}
.thecircle-screenshot-toolbar {
  position: fixed;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  padding: 8px;
  background: rgba(30, 30, 30, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  animation: thecircle-ss-fade-in 0.15s ease-out;
  z-index: 2147483647;
}
.thecircle-screenshot-toolbar-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 6px;
  color: rgba(255, 255, 255, 0.95);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}
.thecircle-screenshot-toolbar-btn:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.25);
}
.thecircle-screenshot-toolbar-btn-primary {
  background: #3b82f6;
  border-color: #3b82f6;
  color: #fff;
}
.thecircle-screenshot-toolbar-btn-primary:hover {
  background: #2563eb;
  border-color: #2563eb;
}
`;let A=!1;function G(){if(A)return;const l=document.createElement("style");l.id="thecircle-screenshot-styles",l.textContent=V,document.head.appendChild(l),A=!0}class W{constructor(){c(this,"overlay",null);c(this,"selectionBox",null);c(this,"sizeIndicator",null);c(this,"hintText",null);c(this,"toolbar",null);c(this,"isSelecting",!1);c(this,"isDragging",!1);c(this,"hasSelection",!1);c(this,"startX",0);c(this,"startY",0);c(this,"dragOffsetX",0);c(this,"dragOffsetY",0);c(this,"currentArea",null);c(this,"callbacks",null);G(),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}show(e){this.callbacks=e,this.createOverlay(),this.attachEventListeners()}hide(){this.detachEventListeners(),this.overlay&&(this.overlay.classList.add("thecircle-screenshot-fade-out"),setTimeout(()=>{var e;(e=this.overlay)==null||e.remove(),this.overlay=null,this.selectionBox=null,this.sizeIndicator=null,this.hintText=null,this.toolbar=null},200))}hideImmediately(){this.detachEventListeners(),this.overlay&&(this.overlay.remove(),this.overlay=null,this.selectionBox=null,this.sizeIndicator=null,this.hintText=null,this.toolbar=null)}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="thecircle-screenshot-overlay thecircle-screenshot-idle",this.hintText=document.createElement("div"),this.hintText.className="thecircle-screenshot-hint",this.hintText.innerHTML=`
      <span>拖拽选择截图区域</span>
      <span class="thecircle-screenshot-hint-divider">|</span>
      <span class="thecircle-screenshot-hint-key">ESC</span>
      <span>取消</span>
      <span class="thecircle-screenshot-hint-divider">|</span>
      <span>点击截取全屏</span>
    `,this.overlay.appendChild(this.hintText),this.selectionBox=document.createElement("div"),this.selectionBox.className="thecircle-screenshot-selection",this.selectionBox.style.display="none",this.overlay.appendChild(this.selectionBox),this.sizeIndicator=document.createElement("div"),this.sizeIndicator.className="thecircle-screenshot-size",this.sizeIndicator.style.display="none",this.overlay.appendChild(this.sizeIndicator),document.body.appendChild(this.overlay)}createToolbar(){var s;if(!this.overlay||!this.currentArea)return;(s=this.toolbar)==null||s.remove(),this.toolbar=document.createElement("div"),this.toolbar.className="thecircle-screenshot-toolbar";const e=this.currentArea.y+this.currentArea.height+10,t=this.currentArea.x+this.currentArea.width/2;this.toolbar.style.left=`${t}px`,this.toolbar.style.top=`${e}px`,e+50>window.innerHeight&&(this.toolbar.style.top=`${this.currentArea.y-50}px`),this.toolbar.innerHTML=`
      <button class="thecircle-screenshot-toolbar-btn thecircle-screenshot-toolbar-btn-primary" data-action="confirm">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        确认
      </button>
      <button class="thecircle-screenshot-toolbar-btn" data-action="reselect">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 4v6h6"></path>
          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
        </svg>
        重选
      </button>
      <button class="thecircle-screenshot-toolbar-btn" data-action="cancel">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        取消
      </button>
    `,this.toolbar.addEventListener("click",i=>{var a;const o=i.target.closest("button");if(!o)return;const r=o.dataset.action;r==="confirm"?this.confirmSelection():r==="reselect"?this.resetSelection():r==="cancel"&&(this.hide(),(a=this.callbacks)==null||a.onCancel())}),this.overlay.appendChild(this.toolbar)}confirmSelection(){const e=this.currentArea;this.hideImmediately(),requestAnimationFrame(()=>{var t;(t=this.callbacks)==null||t.onSelect(e)})}resetSelection(){var e;this.hasSelection=!1,this.currentArea=null,this.isDragging=!1,(e=this.toolbar)==null||e.remove(),this.toolbar=null,this.overlay&&(this.overlay.classList.add("thecircle-screenshot-idle"),this.overlay.classList.remove("thecircle-screenshot-has-selection")),this.selectionBox&&(this.selectionBox.style.display="none",this.selectionBox.classList.remove("thecircle-screenshot-selection-active"),this.selectionBox.classList.remove("thecircle-screenshot-selection-breathe")),this.sizeIndicator&&(this.sizeIndicator.style.display="none"),this.hintText&&(this.hintText.style.opacity="1")}attachEventListeners(){document.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown)}detachEventListeners(){document.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown)}handleMouseDown(e){if(!this.overlay||e.button!==0||this.toolbar&&this.toolbar.contains(e.target))return;const t=e.clientX,s=e.clientY;if(this.hasSelection&&this.currentArea){const{x:i,y:n,width:o,height:r}=this.currentArea;if(t>=i&&t<=i+o&&s>=n&&s<=n+r){this.isDragging=!0,this.dragOffsetX=t-i,this.dragOffsetY=s-n,e.preventDefault();return}else{this.triggerBreatheAnimation(),e.preventDefault();return}}this.isSelecting=!0,this.startX=t,this.startY=s,this.overlay.classList.remove("thecircle-screenshot-idle"),this.selectionBox&&(this.selectionBox.style.display="block",this.selectionBox.style.left=`${this.startX}px`,this.selectionBox.style.top=`${this.startY}px`,this.selectionBox.style.width="0px",this.selectionBox.style.height="0px"),this.sizeIndicator&&(this.sizeIndicator.style.display="block"),this.hintText&&(this.hintText.style.opacity="0"),e.preventDefault()}handleMouseMove(e){if(this.isDragging&&this.currentArea&&this.selectionBox){const a=Math.max(0,Math.min(window.innerWidth-this.currentArea.width,e.clientX-this.dragOffsetX)),h=Math.max(0,Math.min(window.innerHeight-this.currentArea.height,e.clientY-this.dragOffsetY));this.currentArea.x=a,this.currentArea.y=h,this.selectionBox.style.left=`${a}px`,this.selectionBox.style.top=`${h}px`,this.updateToolbarPosition(),this.sizeIndicator&&(this.sizeIndicator.style.left=`${a+this.currentArea.width/2}px`,this.sizeIndicator.style.top=`${h+this.currentArea.height+10}px`);return}if(!this.isSelecting||!this.selectionBox||!this.sizeIndicator)return;const t=e.clientX,s=e.clientY,i=Math.min(this.startX,t),n=Math.min(this.startY,s),o=Math.abs(t-this.startX),r=Math.abs(s-this.startY);this.selectionBox.style.left=`${i}px`,this.selectionBox.style.top=`${n}px`,this.selectionBox.style.width=`${o}px`,this.selectionBox.style.height=`${r}px`,this.sizeIndicator.textContent=`${o} × ${r}`,this.sizeIndicator.style.left=`${i+o/2}px`,this.sizeIndicator.style.top=`${n+r+10}px`}handleMouseUp(e){var a,h;if(this.isDragging){this.isDragging=!1;return}if(!this.isSelecting){this.hasSelection||(this.hideImmediately(),requestAnimationFrame(()=>{var p;(p=this.callbacks)==null||p.onSelect(null)}));return}this.isSelecting=!1;const t=e.clientX,s=e.clientY,i=Math.min(this.startX,t),n=Math.min(this.startY,s),o=Math.abs(t-this.startX),r=Math.abs(s-this.startY);if(o<10||r<10){this.hideImmediately(),requestAnimationFrame(()=>{var p;(p=this.callbacks)==null||p.onSelect(null)});return}this.currentArea={x:i,y:n,width:o,height:r},this.hasSelection=!0,(a=this.overlay)==null||a.classList.add("thecircle-screenshot-has-selection"),(h=this.selectionBox)==null||h.classList.add("thecircle-screenshot-selection-active"),this.createToolbar()}triggerBreatheAnimation(){this.selectionBox&&(this.selectionBox.classList.remove("thecircle-screenshot-selection-breathe"),this.selectionBox.offsetWidth,this.selectionBox.classList.add("thecircle-screenshot-selection-breathe"),setTimeout(()=>{var e;(e=this.selectionBox)==null||e.classList.remove("thecircle-screenshot-selection-breathe")},400))}updateToolbarPosition(){if(!this.toolbar||!this.currentArea)return;const e=this.currentArea.y+this.currentArea.height+10,t=this.currentArea.x+this.currentArea.width/2;this.toolbar.style.left=`${t}px`,e+50>window.innerHeight?this.toolbar.style.top=`${this.currentArea.y-50}px`:this.toolbar.style.top=`${e}px`}handleKeyDown(e){var t;e.key==="Escape"?(e.preventDefault(),this.hide(),(t=this.callbacks)==null||t.onCancel()):e.key==="Enter"&&this.hasSelection&&(e.preventDefault(),this.confirmSelection())}}class Q{constructor(){c(this,"panel",null);c(this,"imageDataUrl","");c(this,"callbacks",null);c(this,"config",y);c(this,"isShowingInput",!1);c(this,"inputMode","ask");c(this,"isLoading",!1)}show(e,t,s){this.imageDataUrl=e,this.callbacks=t,this.config=s||y,this.createPanel()}hide(){this.isLoading&&(m(),this.isLoading=!1),this.panel&&(this.panel.classList.add("thecircle-screenshot-panel-exit"),setTimeout(()=>{this.panel&&(x(this.panel),this.panel=null)},200))}showLoading(e){if(!this.panel)return;this.isLoading=!0;const t=this.panel.querySelector(".thecircle-screenshot-actions");if(t){t.innerHTML=`
        <div class="thecircle-screenshot-loading">
          <div class="thecircle-spinner"></div>
          <span>${e}</span>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 12px;">
          <button class="thecircle-stop-btn" data-action="stop">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="6" y="6" width="12" height="12" rx="2"></rect>
            </svg>
            终止
          </button>
        </div>
      `;const s=t.querySelector('[data-action="stop"]');s==null||s.addEventListener("click",()=>{m(),this.isLoading=!1,this.resetActions()})}}showResult(e,t){if(!this.panel)return;this.isLoading=!1;const s=this.panel.querySelector(".thecircle-screenshot-actions");if(s){s.innerHTML=`
        <div class="thecircle-screenshot-result">
          <div class="thecircle-screenshot-result-header">${e}</div>
          <div class="thecircle-screenshot-result-content">${t}</div>
          <div class="thecircle-screenshot-result-actions">
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-secondary" data-action="copy-result">
              ${d.copy}
              <span>复制</span>
            </button>
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-secondary" data-action="back">
              <span>返回</span>
            </button>
          </div>
        </div>
      `;const i=s.querySelector('[data-action="copy-result"]');i==null||i.addEventListener("click",()=>{navigator.clipboard.writeText(t);const o=i.querySelector("span");if(o){const r=o.textContent;o.textContent="已复制!",setTimeout(()=>{o.textContent=r},1500)}});const n=s.querySelector('[data-action="back"]');n==null||n.addEventListener("click",()=>{this.resetActions()})}}showGeneratedImage(e){if(!this.panel)return;this.isLoading=!1;const t=this.panel.querySelector(".thecircle-screenshot-actions");if(t){t.innerHTML=`
        <div class="thecircle-screenshot-generated">
          <img src="${e}" alt="Generated image" class="thecircle-screenshot-generated-img" />
          <div class="thecircle-screenshot-result-actions">
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-primary" data-action="save-generated">
              ${d.download}
              <span>保存</span>
            </button>
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-secondary" data-action="back">
              <span>返回</span>
            </button>
          </div>
        </div>
      `;const s=t.querySelector('[data-action="save-generated"]');s==null||s.addEventListener("click",async()=>{const n=document.createElement("a");n.href=e,n.download=`generated-${Date.now()}.png`,n.click()});const i=t.querySelector('[data-action="back"]');i==null||i.addEventListener("click",()=>{this.resetActions()})}}streamUpdate(e,t){if(!this.panel)return;this.isLoading=!0;const s=this.panel.querySelector(".thecircle-screenshot-actions");if(!s)return;if(s.querySelector(".thecircle-screenshot-loading")){s.innerHTML=`
        <div class="thecircle-screenshot-result">
          <div style="display: flex; justify-content: flex-end; margin-bottom: 8px;">
            <button class="thecircle-stop-btn" data-action="stop">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="6" y="6" width="12" height="12" rx="2"></rect>
              </svg>
              终止
            </button>
          </div>
          <div class="thecircle-screenshot-result-content"></div>
          <div class="thecircle-screenshot-result-actions">
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-secondary" data-action="copy-result">
              ${d.copy}
              <span>复制</span>
            </button>
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-secondary" data-action="back">
              <span>返回</span>
            </button>
          </div>
        </div>
      `;const o=s.querySelector('[data-action="stop"]');o==null||o.addEventListener("click",()=>{var h;m(),this.isLoading=!1,(h=o.parentElement)==null||h.remove()});const r=s.querySelector('[data-action="copy-result"]');r==null||r.addEventListener("click",()=>{const h=s.querySelector(".thecircle-screenshot-result-content");if(h){navigator.clipboard.writeText(h.textContent||"");const p=r.querySelector("span");if(p){const g=p.textContent;p.textContent="已复制!",setTimeout(()=>{p.textContent=g},1500)}}});const a=s.querySelector('[data-action="back"]');a==null||a.addEventListener("click",()=>{this.resetActions()})}const n=s.querySelector(".thecircle-screenshot-result-content");n&&(n.innerHTML=this.formatContent(t),n.scrollTop=n.scrollHeight)}formatContent(e){return e.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>")}resetActions(){if(!this.panel)return;this.isLoading=!1;const e=this.panel.querySelector(".thecircle-screenshot-actions");e&&(e.innerHTML=this.createActionsHTML(),this.setupActionListeners())}createPanel(){this.panel=document.createElement("div"),this.panel.className="thecircle-screenshot-panel",this.panel.innerHTML=`
      <div class="thecircle-screenshot-header">
        <span class="thecircle-screenshot-title">截图预览</span>
        <button class="thecircle-screenshot-close">${d.x}</button>
      </div>
      <div class="thecircle-screenshot-preview">
        <img src="${this.imageDataUrl}" alt="Screenshot preview" />
      </div>
      <div class="thecircle-screenshot-actions">
        ${this.createActionsHTML()}
      </div>
    `,w(this.panel),this.positionPanel();const e=this.panel.querySelector(".thecircle-screenshot-close");e==null||e.addEventListener("click",()=>{var s;this.hide(),(s=this.callbacks)==null||s.onClose()}),this.setupActionListeners();const t=s=>{var i;s.key==="Escape"&&(this.hide(),(i=this.callbacks)==null||i.onClose(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t)}createActionsHTML(){const e=[{action:"save",icon:d.download,label:"保存",primary:!0},{action:"copy",icon:d.copy,label:"复制"}];return this.config.enableAI&&e.push({action:"ask",icon:d.messageCircle,label:"问AI"},{action:"describe",icon:d.fileText,label:"描述图片"}),this.config.enableImageGen&&e.push({action:"generate",icon:d.sparkles,label:"AI生图"}),`
      <div class="thecircle-screenshot-btn-group">
        ${e.map(t=>`
          <button class="thecircle-screenshot-btn ${t.primary?"thecircle-screenshot-btn-primary":"thecircle-screenshot-btn-secondary"}" data-action="${t.action}">
            ${t.icon}
            <span>${t.label}</span>
          </button>
        `).join("")}
      </div>
    `}setupActionListeners(){if(!this.panel)return;const e=this.panel.querySelector('[data-action="save"]');e==null||e.addEventListener("click",()=>{var o;return(o=this.callbacks)==null?void 0:o.onSave()});const t=this.panel.querySelector('[data-action="copy"]');t==null||t.addEventListener("click",()=>{var r;(r=this.callbacks)==null||r.onCopy();const o=t.querySelector("span");if(o){const a=o.textContent;o.textContent="已复制!",setTimeout(()=>{o.textContent=a},1500)}});const s=this.panel.querySelector('[data-action="ask"]');s==null||s.addEventListener("click",()=>this.showInputField("ask"));const i=this.panel.querySelector('[data-action="describe"]');i==null||i.addEventListener("click",()=>{var o;return(o=this.callbacks)==null?void 0:o.onDescribe()});const n=this.panel.querySelector('[data-action="generate"]');n==null||n.addEventListener("click",()=>this.showInputField("generate"))}showInputField(e){if(!this.panel)return;this.inputMode=e,this.isShowingInput=!0;const t=this.panel.querySelector(".thecircle-screenshot-actions");if(t){const s=e==="ask"?"输入你想问的问题...":"输入生成提示词...",i=e==="ask"?"发送":"生成";t.innerHTML=`
        <div class="thecircle-screenshot-input-area">
          <input
            type="text"
            class="thecircle-screenshot-input"
            placeholder="${s}"
            autofocus
          />
          <div class="thecircle-screenshot-input-actions">
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-secondary" data-action="cancel-input">
              取消
            </button>
            <button class="thecircle-screenshot-btn thecircle-screenshot-btn-primary" data-action="submit-input">
              ${i}
            </button>
          </div>
        </div>
      `;const n=t.querySelector(".thecircle-screenshot-input");n==null||n.focus(),n==null||n.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),this.submitInput(n.value))});const o=t.querySelector('[data-action="cancel-input"]');o==null||o.addEventListener("click",()=>this.resetActions());const r=t.querySelector('[data-action="submit-input"]');r==null||r.addEventListener("click",()=>this.submitInput(n.value))}}submitInput(e){var s,i;const t=e.trim();t&&(this.inputMode==="ask"?(s=this.callbacks)==null||s.onAskAI(t):(i=this.callbacks)==null||i.onGenerateImage(t))}positionPanel(){if(!this.panel)return;const e=this.panel.getBoundingClientRect(),t=(window.innerWidth-e.width)/2,s=(window.innerHeight-e.height)/2;this.panel.style.left=`${Math.max(20,t)}px`,this.panel.style.top=`${Math.max(20,s)}px`}}class Z{constructor(e){c(this,"selectedText","");c(this,"config");c(this,"screenshotSelector",null);c(this,"screenshotPanel",null);c(this,"currentScreenshotDataUrl","");c(this,"flowCallbacks",null);this.config=e}setSelectedText(e){this.selectedText=e}setConfig(e){this.config=e}setFlowCallbacks(e){this.flowCallbacks=e}async execute(e,t){switch(e.action){case"translate":return this.handleTranslate(t);case"summarize":return this.handleSummarize(t);case"explain":return this.handleExplain(t);case"rewrite":return this.handleRewrite(t);case"codeExplain":return this.handleCodeExplain(t);case"search":return this.handleSearch();case"copy":return this.handleCopy();case"sendToAI":return this.handleSendToAI();case"aiChat":return this.handleAIChat();case"summarizePage":return this.handleSummarizePage(t);case"switchTab":return this.handleSwitchTab();case"history":return this.handleHistory();case"screenshot":return this.handleScreenshotFlow();case"bookmark":return this.handleBookmark();case"newTab":return this.handleNewTab();case"settings":return this.handleSettings();default:return{type:"error",result:"Unknown action"}}}async handleTranslate(e){return this.selectedText?this.callAIAction("translate",this.selectedText,e):{type:"error",result:"请先选择要翻译的文字"}}async handleSummarize(e){return this.selectedText?this.callAIAction("summarize",this.selectedText,e):{type:"error",result:"请先选择要总结的文字"}}async handleExplain(e){return this.selectedText?this.callAIAction("explain",this.selectedText,e):{type:"error",result:"请先选择要解释的文字"}}async handleRewrite(e){return this.selectedText?this.callAIAction("rewrite",this.selectedText,e):{type:"error",result:"请先选择要改写的文字"}}async handleCodeExplain(e){return this.selectedText?this.callAIAction("codeExplain",this.selectedText,e):{type:"error",result:"请先选择要解释的代码"}}async handleSummarizePage(e){return this.callAIAction("summarizePage",document.body.innerText.slice(0,1e4),e)}async callAIAction(e,t,s){let i;switch(e){case"translate":i=q(this.config.preferredLanguage||"zh-CN");break;case"summarize":i=j();break;case"explain":i=_();break;case"rewrite":i=F();break;case"codeExplain":i=O();break;case"summarizePage":i=Y();break;default:return{type:"error",result:"Unknown AI action"}}try{const n=await $(t,i,this.config,s);return n.success?{type:"ai",result:n.result}:{type:"error",result:n.error||"AI 请求失败"}}catch(n){return{type:"error",result:`请求失败: ${n}`}}}handleSearch(){const t=`https://www.google.com/search?q=${encodeURIComponent(this.selectedText||"")}`;return window.open(t,"_blank"),{type:"redirect",url:t}}handleCopy(){return this.selectedText?(navigator.clipboard.writeText(this.selectedText),{type:"success",result:"已复制到剪贴板"}):{type:"error",result:"没有选中的文字"}}handleSendToAI(){const t=`https://chat.openai.com/?q=${encodeURIComponent(this.selectedText||"")}`;return window.open(t,"_blank"),{type:"redirect",url:t}}handleAIChat(){return window.open("https://chat.openai.com/","_blank"),{type:"redirect",url:"https://chat.openai.com/"}}async handleSwitchTab(){try{const e=await chrome.runtime.sendMessage({type:"GET_TABS"});return e!=null&&e.tabs?{type:"info",result:`打开了 ${e.tabs.length} 个标签页`}:{type:"error",result:"获取标签页失败"}}catch{return{type:"error",result:"获取标签页失败"}}}handleHistory(){return chrome.runtime.sendMessage({type:"OPEN_URL",payload:"chrome://history"}),{type:"redirect",url:"chrome://history"}}handleScreenshotFlow(){return this.screenshotSelector=new W,this.screenshotSelector.show({onSelect:async e=>{await this.captureAndShowPanel(e)},onCancel:()=>{var e;(e=this.flowCallbacks)==null||e.onToast("截图已取消","info")}}),{type:"silent",result:""}}async captureAndShowPanel(e){var t,s;try{const i=await chrome.runtime.sendMessage({type:"CAPTURE_VISIBLE_TAB"});if(!(i!=null&&i.success)||!i.dataUrl){(t=this.flowCallbacks)==null||t.onToast("截图失败","error");return}let n=i.dataUrl;e&&(n=await this.cropImage(i.dataUrl,e)),this.currentScreenshotDataUrl=n;const o=this.config.screenshot||y;this.screenshotPanel=new Q,this.screenshotPanel.show(n,{onSave:()=>this.saveScreenshot(),onCopy:()=>this.copyScreenshotToClipboard(),onAskAI:r=>this.askAIAboutImage(r),onDescribe:()=>this.describeImage(),onGenerateImage:r=>this.generateImageFromPrompt(r),onClose:()=>{this.screenshotPanel=null}},o)}catch(i){(s=this.flowCallbacks)==null||s.onToast(`截图失败: ${i}`,"error")}}async cropImage(e,t){return new Promise((s,i)=>{const n=new Image;n.onload=()=>{const o=document.createElement("canvas"),r=o.getContext("2d");if(!r){i(new Error("Failed to get canvas context"));return}const a=window.devicePixelRatio||1;o.width=t.width*a,o.height=t.height*a,r.drawImage(n,t.x*a,t.y*a,t.width*a,t.height*a,0,0,t.width*a,t.height*a);const h=this.config.screenshot||y;s(o.toDataURL("image/png",h.imageQuality))},n.onerror=()=>i(new Error("Failed to load image")),n.src=e})}async saveScreenshot(){var e,t;try{const s=`screenshot-${Date.now()}.png`;await chrome.runtime.sendMessage({type:"DOWNLOAD_IMAGE",payload:{dataUrl:this.currentScreenshotDataUrl,filename:s}}),(e=this.flowCallbacks)==null||e.onToast("截图已保存","success")}catch(s){(t=this.flowCallbacks)==null||t.onToast(`保存失败: ${s}`,"error")}}async copyScreenshotToClipboard(){var e,t;try{const i=await(await fetch(this.currentScreenshotDataUrl)).blob();await navigator.clipboard.write([new ClipboardItem({[i.type]:i})]),(e=this.flowCallbacks)==null||e.onToast("已复制到剪贴板","success")}catch(s){(t=this.flowCallbacks)==null||t.onToast(`复制失败: ${s}`,"error")}}async askAIAboutImage(e){if(!this.screenshotPanel)return;this.screenshotPanel.showLoading("AI 正在分析...");const t=N(e),s=await k(this.currentScreenshotDataUrl,t,this.config,(i,n)=>{var o;(o=this.screenshotPanel)==null||o.streamUpdate(i,n)});s.success&&s.result?this.screenshotPanel.showResult("AI 回答",s.result):this.screenshotPanel.showResult("错误",s.error||"AI 请求失败")}async describeImage(){if(!this.screenshotPanel)return;this.screenshotPanel.showLoading("AI 正在描述图片...");const e=K(),t=await k(this.currentScreenshotDataUrl,e,this.config,(s,i)=>{var n;(n=this.screenshotPanel)==null||n.streamUpdate(s,i)});t.success&&t.result?this.screenshotPanel.showResult("图片描述",t.result):this.screenshotPanel.showResult("错误",t.error||"AI 请求失败")}async generateImageFromPrompt(e){if(!this.screenshotPanel)return;const t=this.config.screenshot||y;if(!t.enableImageGen){this.screenshotPanel.showResult("错误","请先在设置中启用 AI 生图功能");return}this.screenshotPanel.showLoading("正在生成图片...");const s=await k(this.currentScreenshotDataUrl,"用简洁的英文描述这张图片的主要内容和风格特征，不超过100词。",this.config),i=s.success?s.result:"",n=i?`Based on this context: "${i}". User request: ${e}`:e,o=await H(n,this.config,t);o.success&&o.imageUrl?this.screenshotPanel.showGeneratedImage(o.imageUrl):this.screenshotPanel.showResult("错误",o.error||"图像生成失败")}async handleBookmark(){try{return await chrome.runtime.sendMessage({type:"ADD_BOOKMARK",payload:{title:document.title,url:window.location.href}}),{type:"success",result:"已添加书签"}}catch{return{type:"error",result:"添加书签失败"}}}handleNewTab(){return chrome.runtime.sendMessage({type:"NEW_TAB"}),{type:"success",result:"已打开新标签页"}}handleSettings(){return chrome.runtime.openOptionsPage(),{type:"redirect",result:"已打开设置页面"}}}class J{constructor(){c(this,"popover",null);c(this,"callbacks",null);c(this,"hideTimeout",null);c(this,"currentRange",null);c(this,"preferredPosition","above");c(this,"scrollHandler",null)}show(e,t,s="above"){this.hide(),this.callbacks=t,this.preferredPosition=s;const i=window.getSelection();i&&i.rangeCount>0&&(this.currentRange=i.getRangeAt(0).cloneRange()),this.createPopover(e,s),this.setupScrollListener()}hide(){if(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.removeScrollListener(),this.popover){this.popover.classList.add("thecircle-selection-popover-exit");const e=this.popover;setTimeout(()=>{x(e)},150),this.popover=null}this.currentRange=null}isVisible(){return this.popover!==null}setupScrollListener(){this.scrollHandler=()=>{this.updatePosition()},window.addEventListener("scroll",this.scrollHandler,!0)}removeScrollListener(){this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler,!0),this.scrollHandler=null)}updatePosition(){if(!this.popover||!this.currentRange)return;const e=this.currentRange.getBoundingClientRect();if(e.bottom<0||e.top>window.innerHeight){this.popover.style.opacity="0",this.popover.style.pointerEvents="none";return}else this.popover.style.opacity="1",this.popover.style.pointerEvents="auto";const{left:t,top:s}=this.calculatePosition(e,this.preferredPosition);this.popover.style.left=`${t}px`,this.popover.style.top=`${s}px`}calculatePosition(e,t){let o=e.left+e.width/2-16,r;return t==="above"?(r=e.top-32-8,r<10&&(r=e.bottom+8)):(r=e.bottom+8,r+32>window.innerHeight-10&&(r=e.top-32-8)),o<10&&(o=10),o+32>window.innerWidth-10&&(o=window.innerWidth-32-10),{left:o,top:r}}createPopover(e,t){this.popover=document.createElement("div"),this.popover.className="thecircle-selection-popover";const{left:s,top:i}=this.calculatePosition(e,t);this.popover.style.left=`${s}px`,this.popover.style.top=`${i}px`,this.popover.innerHTML=`
      <button class="thecircle-selection-popover-btn" data-action="translate" title="翻译">
        ${d.translate}
      </button>
    `,w(this.popover);const n=this.popover.querySelector('[data-action="translate"]');n==null||n.addEventListener("click",o=>{var r;o.stopPropagation(),(r=this.callbacks)==null||r.onTranslate(),this.hide()}),this.popover.addEventListener("mousedown",o=>{o.stopPropagation()})}}const M="thecircle_data";async function ee(){const l=await chrome.storage.local.get(M);return l[M]?l[M]:{config:S,selectionMenuItems:C,globalMenuItems:E}}const te=':host{--glass-bg: rgba(255, 255, 255, .18);--glass-bg-hover: rgba(255, 255, 255, .28);--glass-border: rgba(255, 255, 255, .25);--glass-border-hover: rgba(255, 255, 255, .4);--glass-shadow: rgba(0, 0, 0, .15);--glass-highlight: rgba(255, 255, 255, .5);--text-primary: rgba(255, 255, 255, .95);--text-secondary: rgba(255, 255, 255, .7)}#thecircle-container{--glass-bg: rgba(255, 255, 255, .18);--glass-bg-hover: rgba(255, 255, 255, .28);--glass-border: rgba(255, 255, 255, .25);--glass-border-hover: rgba(255, 255, 255, .4);--glass-shadow: rgba(0, 0, 0, .15);--glass-highlight: rgba(255, 255, 255, .5);--text-primary: rgba(255, 255, 255, .95);--text-secondary: rgba(255, 255, 255, .7)}.thecircle-overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:2147483646;background:#0003;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);animation:thecircle-fade-in .2s ease-out}.thecircle-fade-out{animation:thecircle-fade-out .2s ease-out forwards}@keyframes thecircle-fade-in{0%{opacity:0}to{opacity:1}}@keyframes thecircle-fade-out{0%{opacity:1}to{opacity:0}}.thecircle-menu{position:fixed;z-index:2147483647;pointer-events:none;transform:translate(-50%,-50%) scale(.8);opacity:0;transition:transform .25s cubic-bezier(.34,1.56,.64,1),opacity .2s ease-out}.thecircle-menu-visible{pointer-events:auto;transform:translate(-50%,-50%) scale(1);opacity:1}.thecircle-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:80px;height:80px;border-radius:9999px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#ffffff38;backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);border:1px solid rgba(255,255,255,.3);box-shadow:0 4px 24px #0000001f,inset 0 1px #fff6;overflow:hidden;opacity:0;transition:opacity .15s ease-out}.thecircle-center-visible{opacity:1}.thecircle-center-icon{display:flex;align-items:center;justify-content:center;margin-bottom:2px;color:var(--text-primary);position:relative;z-index:1}.thecircle-center-icon svg{width:24px;height:24px}.thecircle-center-label{font-size:12px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;color:var(--text-primary);max-width:70px;position:relative;z-index:1}.thecircle-item{position:absolute;left:50%;top:50%;width:70px;height:70px;margin-left:-35px;margin-top:-35px;border-radius:9999px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;background:#ffffff2e;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.25);box-shadow:0 4px 16px #0000001a,inset 0 1px #ffffff4d;transition:all .15s ease-out;opacity:0;animation:thecircle-item-in .3s ease-out forwards}.thecircle-item:nth-child(2){animation-delay:.02s}.thecircle-item:nth-child(3){animation-delay:.04s}.thecircle-item:nth-child(4){animation-delay:.06s}.thecircle-item:nth-child(5){animation-delay:.08s}.thecircle-item:nth-child(6){animation-delay:.1s}.thecircle-item:nth-child(7){animation-delay:.12s}.thecircle-item:nth-child(8){animation-delay:.14s}.thecircle-item:nth-child(9){animation-delay:.16s}@keyframes thecircle-item-in{0%{opacity:0;transform:translate(var(--x, 0),var(--y, 0)) scale(.5)}to{opacity:1;transform:translate(var(--x, 0),var(--y, 0)) scale(1)}}.thecircle-item:hover,.thecircle-item-selected{background:#ffffff47;border-color:#fff6;transform:translate(var(--x, 0),var(--y, 0)) scale(1.15);box-shadow:0 8px 32px #00000026,inset 0 1px #fff6}.thecircle-item:active{transform:translate(var(--x, 0),var(--y, 0)) scale(1.05);transition:transform .05s ease-out}.thecircle-item-icon{display:flex;align-items:center;justify-content:center;margin-bottom:2px;color:var(--text-primary);position:relative;z-index:1}.thecircle-item-icon svg{width:18px;height:18px}.thecircle-item-label{font-size:10px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;color:var(--text-primary);max-width:60px;position:relative;z-index:1}.thecircle-result-panel{position:fixed;z-index:2147483647;min-width:300px;max-width:450px;max-height:400px;display:flex;flex-direction:column;background:#1e1e1ed9;backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);border:1px solid rgba(255,255,255,.15);border-radius:16px;box-shadow:0 8px 32px #00000040,inset 0 1px #ffffff1a;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;animation:thecircle-slide-in .25s ease-out;overflow:hidden}.thecircle-result-panel:before{content:"";position:absolute;top:0;left:5%;right:5%;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.3) 50%,transparent 100%);pointer-events:none;z-index:0}@keyframes thecircle-slide-in{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.thecircle-result-header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.08);background:#ffffff08;flex-shrink:0;position:relative;z-index:1}.thecircle-result-title{font-size:14px;font-weight:600;color:var(--text-primary)}.thecircle-result-close{background:#ffffff1a;border:none;font-size:18px;cursor:pointer;padding:0;width:26px;height:26px;display:flex;align-items:center;justify-content:center;border-radius:9999px;color:var(--text-secondary);transition:all .2s ease}.thecircle-result-content{position:relative;padding:16px 18px;font-size:14px;line-height:1.625;overflow-y:auto;overflow-x:hidden;color:var(--text-primary);flex:1;min-height:60px;z-index:1}.thecircle-result-content::-webkit-scrollbar{width:8px}.thecircle-result-content::-webkit-scrollbar-track{background:#ffffff1f;border-radius:4px}.thecircle-result-content::-webkit-scrollbar-thumb{background:#ffffff40;border-radius:4px;-webkit-transition:background .2s ease;transition:background .2s ease}.thecircle-result-content::-webkit-scrollbar-thumb:hover{background:#fff6}.thecircle-result-content code{background:#0003;padding:2px 6px;border-radius:4px;font-family:SF Mono,Monaco,Cascadia Code,Consolas,monospace;font-size:13px}.thecircle-result-content pre{background:#00000040;padding:12px;border-radius:8px;overflow-x:auto;margin:8px 0;border:1px solid rgba(255,255,255,.1)}.thecircle-result-content pre code{background:transparent;padding:0}.thecircle-result-content-wrapper{position:relative;flex:1;min-height:60px;display:flex;flex-direction:column;z-index:1}.thecircle-result-content-wrapper:before,.thecircle-result-content-wrapper:after{content:"";position:absolute;left:0;right:8px;height:24px;pointer-events:none;z-index:2;opacity:0;transition:opacity .2s ease}.thecircle-result-content-wrapper:before{top:0;background:linear-gradient(to bottom,rgba(30,30,30,.9) 0%,transparent 100%)}.thecircle-result-content-wrapper:after{bottom:0;background:linear-gradient(to top,rgba(30,30,30,.9) 0%,transparent 100%)}.thecircle-result-content-wrapper.has-scroll-top:before{opacity:1}.thecircle-result-content-wrapper.has-scroll-bottom:after{opacity:1}.thecircle-loading{display:flex;align-items:center;justify-content:center;min-height:80px}.thecircle-spinner{width:32px;height:32px;border-radius:9999px;border:3px solid rgba(255,255,255,.1);border-top-color:#ffffffb3;animation:thecircle-spin .8s linear infinite}@keyframes thecircle-spin{to{transform:rotate(360deg)}}.thecircle-skeleton{background:linear-gradient(90deg,#ffffff1a 25%,#fff3,#ffffff1a 75%);background-size:200% 100%;animation:thecircle-shimmer 1.5s infinite;border-radius:4px}.thecircle-skeleton-line{height:14px;margin-bottom:8px}.thecircle-skeleton-line:last-child{width:60%;margin-bottom:0}@keyframes thecircle-shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.thecircle-result-actions{padding:14px 18px;display:flex;justify-content:flex-end;gap:8px;border-top:1px solid rgba(255,255,255,.1);flex-shrink:0;position:relative;z-index:1}.thecircle-copy-btn{border:none;color:var(--text-primary);padding:8px 16px;border-radius:8px;font-size:14px;cursor:pointer;background:#ffffff1f;border:1px solid rgba(255,255,255,.15);transition:all .15s ease;display:flex;align-items:center;gap:6px}.thecircle-copy-btn:hover{background:#fff3;border-color:#ffffff40}.thecircle-copy-btn.copied{background:#22c55e4d;border-color:#22c55e80}.thecircle-copy-btn-icon{width:16px;height:16px;display:flex;align-items:center;justify-content:center}.thecircle-toast{position:fixed;left:50%;transform:translate(-50%);z-index:2147483647;padding:12px 20px;font-size:14px;border-radius:9999px;background:#1e1e1ef2;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.15);color:#fffffff2;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;box-shadow:0 4px 16px #00000040,inset 0 1px #ffffff1a;animation:thecircle-toast-in .25s ease-out;display:flex;align-items:center;gap:10px}.thecircle-toast[data-index="0"]{bottom:24px}.thecircle-toast[data-index="1"]{bottom:74px}.thecircle-toast[data-index="2"]{bottom:124px}.thecircle-toast[data-index="3"]{bottom:174px}.thecircle-toast-success{border-left:3px solid rgba(34,197,94,.8)}.thecircle-toast-error{border-left:3px solid rgba(239,68,68,.8)}.thecircle-toast-warning{border-left:3px solid rgba(234,179,8,.8)}.thecircle-toast-info{border-left:3px solid rgba(59,130,246,.8)}.thecircle-toast-icon{width:18px;height:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.thecircle-toast-success .thecircle-toast-icon{color:#22c55e}.thecircle-toast-error .thecircle-toast-icon{color:#ef4444}.thecircle-toast-warning .thecircle-toast-icon{color:#eab308}.thecircle-toast-info .thecircle-toast-icon{color:#3b82f6}@keyframes thecircle-toast-in{0%{opacity:0;transform:translate(-50%) translateY(20px)}to{opacity:1;transform:translate(-50%) translateY(0)}}@keyframes thecircle-toast-out{0%{opacity:1;transform:translate(-50%) translateY(0)}to{opacity:0;transform:translate(-50%) translateY(20px)}}.thecircle-toast-exit{animation:thecircle-toast-out .2s ease-out forwards}@media (max-width: 500px){.thecircle-result-panel{min-width:calc(100vw - 40px);max-width:calc(100vw - 40px);left:20px!important;right:20px!important}.thecircle-item{width:60px;height:60px;margin-left:-30px;margin-top:-30px}.thecircle-center{width:70px;height:70px}.thecircle-center-label{font-size:11px;max-width:60px}.thecircle-item-label{font-size:9px}}@media (max-height: 400px){.thecircle-result-panel{max-height:calc(100vh - 40px)}}.thecircle-screenshot-overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:2147483646;background:#0006;cursor:crosshair;animation:thecircle-fade-in .15s ease-out}.thecircle-screenshot-fade-out{animation:thecircle-fade-out .2s ease-out forwards}.thecircle-screenshot-hint{position:fixed;top:20px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:8px;padding:12px 20px;background:#1e1e1ee6;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.15);border-radius:9999px;color:var(--text-primary);font-size:14px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;box-shadow:0 4px 20px #0003;transition:opacity .2s ease}.thecircle-screenshot-hint-divider{color:#ffffff4d}.thecircle-screenshot-hint-key{background:#ffffff26;padding:2px 8px;border-radius:4px;font-size:12px;font-weight:500}.thecircle-screenshot-selection{position:fixed;border:2px solid #3b82f6;background:transparent;box-shadow:0 0 0 9999px #00000080;pointer-events:none}.thecircle-screenshot-size{position:fixed;transform:translate(-50%);padding:4px 10px;background:#1e1e1ee6;border:1px solid rgba(255,255,255,.15);border-radius:4px;color:var(--text-primary);font-size:12px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;pointer-events:none}.thecircle-screenshot-toolbar{position:fixed;transform:translate(-50%);display:flex;gap:8px;padding:8px;background:#1e1e1ef2;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.15);border-radius:10px;box-shadow:0 4px 20px #0000004d;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;animation:thecircle-fade-in .15s ease-out;z-index:2147483647}.thecircle-screenshot-toolbar-btn{display:flex;align-items:center;gap:6px;padding:8px 14px;background:#ffffff1a;border:1px solid rgba(255,255,255,.15);border-radius:6px;color:var(--text-primary);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s ease}.thecircle-screenshot-toolbar-btn:hover{background:#ffffff26;border-color:#ffffff40}.thecircle-screenshot-toolbar-btn-primary{background:#3b82f6;border-color:#3b82f6;color:#fff}.thecircle-screenshot-toolbar-btn-primary:hover{background:#2563eb;border-color:#2563eb}.thecircle-screenshot-panel{position:fixed;z-index:2147483647;min-width:320px;max-width:500px;background:#1e1e1ef2;backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);border:1px solid rgba(255,255,255,.15);border-radius:16px;box-shadow:0 8px 40px #0000004d;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;animation:thecircle-slide-in .25s ease-out;overflow:hidden}.thecircle-screenshot-panel-exit{animation:thecircle-fade-out .2s ease-out forwards}.thecircle-screenshot-header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.08);background:#ffffff08}.thecircle-screenshot-title{font-size:14px;font-weight:600;color:var(--text-primary)}.thecircle-screenshot-close{background:#ffffff1a;border:none;cursor:pointer;padding:0;width:26px;height:26px;display:flex;align-items:center;justify-content:center;border-radius:9999px;color:var(--text-secondary);transition:all .2s ease}.thecircle-screenshot-close:hover{background:#fff3;color:var(--text-primary)}.thecircle-screenshot-close svg{width:16px;height:16px}.thecircle-screenshot-preview{padding:16px;background:#0003}.thecircle-screenshot-preview img{width:100%;max-height:300px;-o-object-fit:contain;object-fit:contain;border-radius:8px;box-shadow:0 2px 10px #0003}.thecircle-screenshot-actions{padding:16px 18px;border-top:1px solid rgba(255,255,255,.08)}.thecircle-screenshot-btn-group{display:flex;flex-wrap:wrap;gap:8px}.thecircle-screenshot-btn{display:flex;align-items:center;gap:6px;padding:8px 14px;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .15s ease;font-family:inherit}.thecircle-screenshot-btn svg{width:16px;height:16px}.thecircle-screenshot-btn-primary{background:#3b82f6;color:#fff}.thecircle-screenshot-btn-primary:hover{background:#2563eb}.thecircle-screenshot-btn-secondary{background:#ffffff1a;color:var(--text-primary);border:1px solid rgba(255,255,255,.15)}.thecircle-screenshot-btn-secondary:hover{background:#ffffff26}.thecircle-screenshot-input-area{display:flex;flex-direction:column;gap:12px}.thecircle-screenshot-input{width:100%;padding:10px 14px;background:#ffffff14;border:1px solid rgba(255,255,255,.15);border-radius:8px;color:var(--text-primary);font-size:14px;font-family:inherit;outline:none;transition:all .15s ease}.thecircle-screenshot-input:focus{border-color:#3b82f6;background:#3b82f61a}.thecircle-screenshot-input::-moz-placeholder{color:#fff6}.thecircle-screenshot-input::placeholder{color:#fff6}.thecircle-screenshot-input-actions{display:flex;justify-content:flex-end;gap:8px}.thecircle-screenshot-loading{display:flex;align-items:center;justify-content:center;gap:12px;padding:20px;color:var(--text-secondary);font-size:14px}.thecircle-screenshot-result{display:flex;flex-direction:column;gap:12px}.thecircle-screenshot-result-header{font-size:13px;font-weight:600;color:var(--text-secondary)}.thecircle-screenshot-result-content{max-height:200px;overflow-y:auto;padding:12px;background:#0003;border-radius:8px;font-size:14px;line-height:1.6;color:var(--text-primary)}.thecircle-screenshot-result-content::-webkit-scrollbar{width:6px}.thecircle-screenshot-result-content::-webkit-scrollbar-track{background:#ffffff1a;border-radius:3px}.thecircle-screenshot-result-content::-webkit-scrollbar-thumb{background:#fff3;border-radius:3px}.thecircle-screenshot-result-content code{background:#ffffff1a;padding:2px 6px;border-radius:4px;font-family:SF Mono,Monaco,Cascadia Code,Consolas,monospace;font-size:13px}.thecircle-screenshot-result-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:8px}.thecircle-screenshot-generated{display:flex;flex-direction:column;gap:12px}.thecircle-screenshot-generated-img{width:100%;max-height:300px;-o-object-fit:contain;object-fit:contain;border-radius:8px;box-shadow:0 2px 10px #0003}.thecircle-stop-btn{display:flex;align-items:center;gap:6px;padding:6px 12px;background:#ef444433;border:1px solid rgba(239,68,68,.4);border-radius:6px;color:#ef4444;font-size:12px;font-weight:500;cursor:pointer;transition:all .15s ease;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}.thecircle-stop-btn:hover{background:#ef44444d;border-color:#ef444499}.thecircle-stop-btn svg{width:14px;height:14px}.thecircle-loading-container{display:flex;flex-direction:column;align-items:center;gap:12px;padding:16px}.thecircle-loading-row{display:flex;align-items:center;gap:12px}.thecircle-loading-text{color:var(--text-secondary);font-size:14px}.thecircle-selection-popover{position:fixed;z-index:2147483647;display:flex;align-items:center;justify-content:center;width:32px;height:32px;padding:0;background:linear-gradient(135deg,#ffffff40,#ffffff1f,#ffffff2e);backdrop-filter:blur(40px) saturate(180%);-webkit-backdrop-filter:blur(40px) saturate(180%);border:1px solid rgba(255,255,255,.35);border-top-color:#ffffff80;border-bottom-color:#ffffff26;border-radius:9999px;box-shadow:0 8px 32px #0003,0 2px 8px #0000001a,inset 0 1px 1px #fff6,inset 0 -1px 1px #0000000d;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;animation:thecircle-popover-in .2s cubic-bezier(.34,1.56,.64,1);transition:all .2s cubic-bezier(.34,1.56,.64,1);cursor:pointer}.thecircle-selection-popover:hover{transform:scale(1.1);background:linear-gradient(135deg,#ffffff59,#fff3,#ffffff47);box-shadow:0 12px 40px #00000040,0 4px 12px #00000026,inset 0 1px 2px #ffffff80,inset 0 -1px 1px #0000000d}.thecircle-selection-popover:active{transform:scale(.95);background:linear-gradient(135deg,#ffffff26,#ffffff14,#ffffff1f);box-shadow:0 4px 16px #0003,0 2px 6px #0000001a,inset 0 1px 1px #ffffff4d,inset 0 -1px 1px #00000014}.thecircle-selection-popover-exit{animation:thecircle-popover-out .15s ease-out forwards}@keyframes thecircle-popover-in{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}@keyframes thecircle-popover-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.9)}}.thecircle-selection-popover-btn{display:flex;align-items:center;justify-content:center;width:100%;height:100%;padding:0;background:transparent;border:none;border-radius:9999px;color:#000000a6;cursor:pointer;transition:color .2s ease}.thecircle-selection-popover:hover .thecircle-selection-popover-btn{color:#000000d9}.thecircle-selection-popover:active .thecircle-selection-popover-btn{color:#000000b3}.thecircle-selection-popover-btn svg{width:16px;height:16px}';class P{constructor(){c(this,"radialMenu");c(this,"menuActions");c(this,"selectionPopover");c(this,"selectionMenuItems",C);c(this,"globalMenuItems",E);c(this,"config",S);c(this,"lastKeyTime",0);c(this,"lastKey","");c(this,"DOUBLE_TAP_DELAY",300);c(this,"activeToasts",[]);c(this,"MAX_TOASTS",4);c(this,"currentSelectedText","");this.radialMenu=new X,this.menuActions=new Z(S),this.selectionPopover=new J,this.menuActions.setFlowCallbacks({onToast:(e,t)=>this.showToast(e,t)}),this.init()}async init(){T(),B(te),await this.loadConfig(),this.setupKeyboardShortcut(),this.setupMessageListener(),this.setupStorageListener(),this.setupSelectionListener(),console.log("The Circle: Initialized with Shadow DOM")}async loadConfig(){try{const e=await ee();this.config=e.config,this.menuActions.setConfig(e.config),this.selectionMenuItems=e.selectionMenuItems,this.globalMenuItems=e.globalMenuItems}catch(e){console.error("The Circle: Failed to load config",e)}}setupStorageListener(){chrome.storage.onChanged.addListener(e=>{e.thecircle_config&&(this.config={...this.config,...e.thecircle_config.newValue},this.menuActions.setConfig(this.config))})}setupSelectionListener(){let e=null;document.addEventListener("mouseup",t=>{var i;const s=t.composedPath();for(const n of s)if(n instanceof HTMLElement&&((i=n.classList)!=null&&i.contains("thecircle-selection-popover")))return;e&&clearTimeout(e),e=window.setTimeout(()=>{const n=window.getSelection(),o=(n==null?void 0:n.toString().trim())||"";if(o&&n&&n.rangeCount>0){const a=n.getRangeAt(0).getBoundingClientRect();this.currentSelectedText=o;const h=this.config.popoverPosition||"above";this.selectionPopover.show(a,{onTranslate:()=>this.handleSelectionTranslate()},h)}else this.selectionPopover.hide(),this.currentSelectedText=""},10)}),document.addEventListener("mousedown",t=>{var i,n;const s=t.composedPath();for(const o of s)if(o instanceof HTMLElement&&((i=o.classList)!=null&&i.contains("thecircle-selection-popover")))return;(n=window.getSelection())!=null&&n.toString().trim()||this.selectionPopover.hide()})}async handleSelectionTranslate(){if(!this.currentSelectedText)return;const e=this.selectionMenuItems.find(a=>a.action==="translate");if(!e){this.showToast("翻译功能未配置","error");return}this.menuActions.setSelectedText(this.currentSelectedText);const t=window.getSelection();let s=null;t&&t.rangeCount>0&&(s=t.getRangeAt(0).getBoundingClientRect());const i=s?s.left+s.width/2:window.innerWidth/2,n=s?s.bottom+20:window.innerHeight/2;this.radialMenu.setSelectionInfo(s),this.radialMenu.showResultOnly(i,n,e.label);const o=this.config.useStreaming?(a,h)=>{this.radialMenu.streamUpdate(a,h)}:void 0,r=await this.menuActions.execute(e,o);r.type==="error"?this.radialMenu.showResult("错误",r.result||"未知错误"):!this.config.useStreaming&&r.type==="ai"&&this.radialMenu.updateResult(r.result||"")}setupKeyboardShortcut(){const e=new Set;document.addEventListener("keydown",t=>{if(e.add(t.key),this.config.shortcut.startsWith("Double+")){const s=this.config.shortcut.slice(7);if(this.matchDoubleTapKey(t.key,s)){const i=Date.now();this.lastKey===t.key&&i-this.lastKeyTime<this.DOUBLE_TAP_DELAY?(t.preventDefault(),this.showMenu(),this.lastKeyTime=0,this.lastKey=""):(this.lastKeyTime=i,this.lastKey=t.key)}}else this.matchShortcut(t,this.config.shortcut)&&(t.preventDefault(),this.showMenu())}),document.addEventListener("keyup",t=>{e.delete(t.key)}),window.addEventListener("blur",()=>{e.clear()})}matchDoubleTapKey(e,t){return({Control:["Control","ControlLeft","ControlRight"],Shift:["Shift","ShiftLeft","ShiftRight"],Alt:["Alt","AltLeft","AltRight"],Meta:["Meta","MetaLeft","MetaRight"],Space:[" ","Space"],Tab:["Tab"]}[t]||[t]).includes(e)||e.toLowerCase()===t.toLowerCase()}matchShortcut(e,t){const s=t.split("+"),i=s[s.length-1],n=s.includes("Ctrl"),o=s.includes("Alt"),r=s.includes("Shift");return(i==="Space"?e.key===" ":e.key.toUpperCase()===i.toUpperCase())&&(e.ctrlKey||e.metaKey)===n&&e.altKey===o&&e.shiftKey===r}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,s)=>(e.type==="TOGGLE_MENU"&&(this.showMenu(),s({success:!0})),!0))}showMenu(){this.selectionPopover.hide();const e=this.globalMenuItems,t=window.innerWidth/2,s=window.innerHeight/2;this.radialMenu.setSelectionInfo(null),this.radialMenu.show(t,s,e,async i=>{await this.handleMenuAction(i)})}async handleMenuAction(e){if(["translate","summarize","explain","rewrite","codeExplain","summarizePage"].includes(e.action)){this.radialMenu.showResult(e.label,"",!0);const s=this.config.useStreaming?(n,o)=>{this.radialMenu.streamUpdate(n,o)}:void 0,i=await this.menuActions.execute(e,s);i.type==="error"?this.radialMenu.showResult("错误",i.result||"未知错误"):!this.config.useStreaming&&i.type==="ai"&&this.radialMenu.updateResult(i.result||"")}else{const s=await this.menuActions.execute(e);s.type==="error"?this.showToast(s.result||"未知错误","error"):s.type==="success"?this.showToast(s.result||"操作成功","success"):s.type==="info"&&this.showToast(s.result||"","info")}}getToastIcon(e){return{success:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>`,error:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>`,warning:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>`,info:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>`}[e]}showToast(e,t="info"){if(this.activeToasts.length>=this.MAX_TOASTS){const n=this.activeToasts.shift();n&&(clearTimeout(n.timeoutId),x(n.element))}const s=document.createElement("div");s.className=`thecircle-toast thecircle-toast-${t}`,s.innerHTML=`
      <span class="thecircle-toast-icon">${this.getToastIcon(t)}</span>
      <span class="thecircle-toast-message">${e}</span>
    `,w(s),this.updateToastPositions();const i=window.setTimeout(()=>{this.removeToast(s)},2e3);this.activeToasts.push({element:s,timeoutId:i})}updateToastPositions(){this.activeToasts.forEach((e,t)=>{e.element.setAttribute("data-index",String(t))})}removeToast(e){const t=this.activeToasts.findIndex(s=>s.element===e);if(t!==-1){const s=this.activeToasts[t];clearTimeout(s.timeoutId),this.activeToasts.splice(t,1),e.classList.add("thecircle-toast-exit"),setTimeout(()=>{x(e),this.updateToastPositions()},200)}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new P):new P})();
